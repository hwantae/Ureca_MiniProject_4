<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë£¸ ì˜ˆì•½</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        h1 {
            color: #333;
        }

        a {
            color: #666;
        }

        .date-section {
            margin: 20px 0;
        }

        .date-section input {
            padding: 8px;
            font-size: 1em;
        }

        .slots {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .slot {
            padding: 15px 20px;
            border: 1px solid #ddd;
            background: #fff;
            cursor: pointer;
            text-align: center;
            min-width: 80px;
        }

        .slot:hover {
            background: #e0e0e0;
        }

        .slot.available {
            border-color: green;
        }

        .slot.unavailable {
            border-color: red;
            background: #fee;
            cursor: not-allowed;
        }

        .slot.selected {
            background: #d0e0ff;
            border-color: blue;
        }

        .reserve-section {
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border: 1px solid #ddd;
        }

        button {
            padding: 10px 30px;
            font-size: 1em;
            cursor: pointer;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <a href="rooms.html">â† ëª©ë¡ìœ¼ë¡œ</a>
    <h1 id="title">ë£¸ ì˜ˆì•½</h1>

    <div class="date-section">
        ğŸ“… ë‚ ì§œ: <input type="date" id="date">
    </div>

    <div id="slots" class="slots">ë¡œë”© ì¤‘...</div>

    <div class="reserve-section">
        ì„ íƒ: <span id="selected">ì—†ìŒ</span>
        <button id="reserveBtn" disabled>ì˜ˆì•½í•˜ê¸°</button>
    </div>

    <script>
        const roomName = new URLSearchParams(location.search).get('name') || '';
        let selectedSlot = null;

        if (!roomName) location.href = 'index.html';
        document.getElementById('title').textContent = `${roomName} ì˜ˆì•½`;

        const dateInput = document.getElementById('date');
        dateInput.value = new Date().toISOString().split('T')[0];
        dateInput.addEventListener('change', () => loadSlots(dateInput.value));

        async function loadSlots(date) {
            const container = document.getElementById('slots');
            try {
                const res = await fetch(`/api/rooms/name/${encodeURIComponent(roomName)}/slots/date?date=${date}`);
                const slots = await res.json();

                if (slots.length === 0) {
                    container.innerHTML = '<p style="color:#888">ë“±ë¡ëœ ì‹œê°„ëŒ€ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.</p>';
                    return;
                }
                container.innerHTML = slots.map(s => {
                    const time = s.startTime.substring(0, 5);
                    const cls = s.isAvailable ? 'available' : 'unavailable';
                    return `<div class="slot ${cls}" onclick="selectSlot(this, '${time}', ${s.isAvailable})">${time}</div>`;
                }).join('');
            } catch (e) {
                container.innerHTML = 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨';
            }
        }

        function selectSlot(el, time, available = true) {
            if (!available) return;
            document.querySelectorAll('.slot.selected').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            selectedSlot = time;
            document.getElementById('selected').textContent = time;
            document.getElementById('reserveBtn').disabled = false;
        }

        document.getElementById('reserveBtn').onclick = () => {
            alert(`ì˜ˆì•½ ê¸°ëŠ¥ì€ Bë‹´ë‹¹ API ì—°ë™ í•„ìš”\n\n${roomName} / ${dateInput.value} / ${selectedSlot}`);
        };

        loadSlots(dateInput.value);
    </script>
</body>

</html>